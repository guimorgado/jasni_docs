---
title: "Webhooks"
description: "Set up real-time notifications with the Jasni Python SDK"
icon: "/icons-svg/webhook.svg"
---

The `webhooks` resource allows you to create, list, update, and delete webhooks for receiving real-time notifications about email events.

## List Webhooks

Retrieve all webhooks:

```python
result = jasni.webhooks.list()

for webhook in result.webhooks:
    print(f"{webhook.url} - Events: {', '.join(webhook.events)}")
    print(f"  Active: {webhook.active}")
```

### Response

```python
@dataclass
class Webhook:
    id: str
    url: str
    events: List[str]
    active: bool
    description: Optional[str] = None
    created_at: str
    updated_at: Optional[str] = None

@dataclass
class ListWebhooksResponse:
    webhooks: List[Webhook]
```

## Create Webhook

Create a new webhook:

```python
result = jasni.webhooks.create(
    url="https://my-server.com/webhook",
    events=["email.received", "email.sent"],
    description="My webhook",  # Optional
)

# IMPORTANT: Save the secret! It's only returned on creation
print(f"Webhook ID: {result.webhook.id}")
print(f"Webhook Secret: {result.webhook.secret}")
```

<Warning>
  **Save your webhook secret!** The `secret` is only returned when the webhook is created. You'll need it to verify incoming webhook payloads.
</Warning>

### Options

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `url` | `str` | Yes | Webhook URL (must be HTTP or HTTPS) |
| `events` | `List[str]` | Yes | Events to subscribe to |
| `description` | `str` | No | Description |

### Available Events

| Event | Description |
|-------|-------------|
| `email.received` | New email received |
| `email.sent` | Email sent |
| `email.bounced` | Email bounced |
| `email.spam` | Email marked as spam |
| `email.deleted` | Email deleted |

### Response

```python
@dataclass
class CreateWebhookResponse:
    webhook: Webhook  # Includes secret field
```

## Update Webhook

Update an existing webhook:

```python
jasni.webhooks.update(
    id="webhook-id",
    url="https://new-url.com/webhook",  # Optional
    events=["email.received"],           # Optional
    active=False,                         # Optional
    description="Updated description",    # Optional
)
```

### Options

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `id` | `str` | Yes | Webhook ID |
| `url` | `str` | No | New URL |
| `events` | `List[str]` | No | Events to subscribe to |
| `active` | `bool` | No | Enable/disable webhook |
| `description` | `str` | No | Description |

### Response

```python
@dataclass
class UpdateWebhookResponse:
    webhook: Webhook
```

## Delete Webhook

Delete a webhook:

```python
jasni.webhooks.delete("webhook-id")
```

## Example: Webhook Management

Here's a complete example of managing webhooks:

```python
from jasni import Jasni

jasni = Jasni("jsk_your_api_key")

def manage_webhooks():
    # Create a webhook for all email events
    result = jasni.webhooks.create(
        url="https://my-server.com/jasni-webhook",
        events=["email.received", "email.sent", "email.bounced"],
        description="Production webhook",
    )
    
    webhook = result.webhook
    print(f"Created webhook: {webhook.id}")
    print(f"Secret (save this!): {webhook.secret}")
    
    # List all webhooks
    webhooks_result = jasni.webhooks.list()
    print(f"Total webhooks: {len(webhooks_result.webhooks)}")
    
    # Disable a webhook temporarily
    jasni.webhooks.update(
        id=webhook.id,
        active=False,
    )
    print("Webhook disabled")
    
    # Re-enable and update events
    jasni.webhooks.update(
        id=webhook.id,
        active=True,
        events=["email.received"],  # Only receive events
    )
    print("Webhook enabled with updated events")
    
    # Delete a webhook
    jasni.webhooks.delete(webhook.id)
    print("Webhook deleted")

manage_webhooks()
```

## Verifying Webhook Signatures

The SDK provides a helper function to verify webhook signatures:

```python
from jasni.webhooks import verify_signature

def handle_webhook(request):
    payload = request.body
    signature = request.headers.get("X-Jasni-Signature")
    
    if verify_signature(payload, signature, webhook_secret):
        # Process the webhook
        data = json.loads(payload)
        print(f"Received event: {data['event']}")
    else:
        return "Invalid signature", 401
```

### Manual Verification

If you prefer to verify signatures manually:

```python
import hmac
import hashlib

def verify_webhook_signature(
    payload: bytes,
    signature: str,
    secret: str
) -> bool:
    expected_signature = hmac.new(
        secret.encode(),
        payload,
        hashlib.sha256
    ).hexdigest()
    
    return hmac.compare_digest(signature, expected_signature)
```

### Flask Example

```python
from flask import Flask, request, jsonify
import json
from jasni.webhooks import verify_signature

app = Flask(__name__)

WEBHOOK_SECRET = "your-webhook-secret"

@app.route("/jasni-webhook", methods=["POST"])
def handle_webhook():
    signature = request.headers.get("X-Jasni-Signature")
    payload = request.data
    
    if not verify_signature(payload, signature, WEBHOOK_SECRET):
        return jsonify({"error": "Invalid signature"}), 401
    
    event = request.json
    print(f"Received event: {event['type']}")
    
    if event["type"] == "email.received":
        print(f"New email from: {event['data']['from']}")
    elif event["type"] == "email.sent":
        print(f"Email sent to: {event['data']['to']}")
    elif event["type"] == "email.bounced":
        print(f"Email bounced: {event['data']['bounce_reason']}")
    
    return jsonify({"status": "ok"}), 200

if __name__ == "__main__":
    app.run(port=3000)
```

### FastAPI Example

```python
from fastapi import FastAPI, Request, HTTPException
from jasni.webhooks import verify_signature

app = FastAPI()

WEBHOOK_SECRET = "your-webhook-secret"

@app.post("/jasni-webhook")
async def handle_webhook(request: Request):
    signature = request.headers.get("X-Jasni-Signature")
    payload = await request.body()
    
    if not verify_signature(payload, signature, WEBHOOK_SECRET):
        raise HTTPException(status_code=401, detail="Invalid signature")
    
    event = await request.json()
    print(f"Received event: {event['type']}")
    
    match event["type"]:
        case "email.received":
            print(f"New email from: {event['data']['from']}")
        case "email.sent":
            print(f"Email sent to: {event['data']['to']}")
        case "email.bounced":
            print(f"Email bounced: {event['data']['bounce_reason']}")
    
    return {"status": "ok"}
```

## Webhook Payload Structure

All webhook payloads follow this structure:

```python
{
    "id": "evt_123abc",           # Unique event ID
    "type": "email.received",     # Event type
    "created_at": "2024-01-15T10:00:00Z",  # ISO timestamp
    "data": {
        "account": "me@mail.jasni.ai",  # Email account
        "uid": 123,                      # Email UID
        "message_id": "<msg@example.com>",  # Message ID
        "from": "sender@example.com",    # Sender
        "to": ["recipient@example.com"], # Recipients
        "subject": "Hello!",             # Subject
        # Additional fields based on event type
    }
}
```

For more details on webhook payloads and best practices, see the [Webhooks Guide](/webhooks/overview).

## Async Example

```python
import asyncio
from jasni import AsyncJasni

async def manage_webhooks_async():
    jasni = AsyncJasni("jsk_your_api_key")
    
    # Create a webhook
    result = await jasni.webhooks.create(
        url="https://my-server.com/webhook",
        events=["email.received", "email.sent"],
    )
    print(f"Created webhook: {result.webhook.id}")
    print(f"Secret: {result.webhook.secret}")
    
    # List all webhooks
    webhooks_result = await jasni.webhooks.list()
    print(f"Total webhooks: {len(webhooks_result.webhooks)}")
    
    # Update webhook
    await jasni.webhooks.update(
        id=result.webhook.id,
        active=False,
    )
    print("Webhook disabled")
    
    # Delete webhook
    await jasni.webhooks.delete(result.webhook.id)
    print("Webhook deleted")
    
    await jasni.close()

asyncio.run(manage_webhooks_async())
```
